{% extends "base.njk" %}
{% set pageTitle = "Download your document to your GOV.UK Wallet" %}
{% set containerClasses = "govuk-disable-max-width" %}
{% block content %}
    <link rel="stylesheet" href="/assets/jsontree.js.css">
    <script src="/assets/jsontree.js"></script>
    <script>
        const jsontreeBindingOptions = {
            sortPropertyNames: false,
            fileDroppingEnabled: false,
            allowEditing: {
                booleanValues: false,
                decimalValues: false,
                numberValues: false,
                stringValues: false,
                dateValues: false,
                bigIntValues: false,
                guidValues: false,
                colorValues: false,
                propertyName: false,
                urlValues: false,
                emailValues: false,
                regExpValues: false,
                symbolValues: false,
                imageValues: false,
                bulk: false,
            },
            dateTimeFormat: "{yyyy}-{mm}-{dd}T{hh}:{MM}:{ss}Z",
            showUrlOpenButtons: false,
            showEmailOpenButtons: false,
            title: {
                showCloseOpenAllButtons: false,
            },
            controlPanel: {
                enabled: false,
            },
            sideMenu: {
                enabled: false,
            },
            autoClose: {
                objectSize: 6,
                arraySize: 6,
                mapSize: 6,
                setSize: 6,
            }
        }
    </script>
    <h1 class="govuk-heading-l govuk-!-margin-top-3">Example GOV.UK Wallet Credential Issuer</h1>
    <h1 class="govuk-heading-m">Quick links:</h1>
    <ul class="govuk-list">
        <li>
            <a class="govuk-link" href="#preauth">Pre-auth code</a>
        </li>
        <li>
            <a class="govuk-link" href="#preauthclaims">Pre-auth code Claims</a>
        </li>
        <li>
            <a class="govuk-link" href="#access">Access Token</a>
        </li>
        <li>
            <a class="govuk-link" href="#tokenclaims">Token Claims</a>
        </li>
        <li>
            <a class="govuk-link" href="#proofjwt">Proof JWT</a>
        </li>
        <li>
            <a class="govuk-link" href="#proofjwtclaims">Proof JWT Claims</a>
        </li>
        <li>
            <a class="govuk-link" href="#explorer">Credential Explorer</a>
        </li>
        {% if credentialSignature %}
            <li>
                <a class="govuk-link" href="#x5chain">X509 Certificate Chain</a>
            </li>
            <li>
                <a class="govuk-link" href="#x5chainHex">X509 Certificate Chain Hex</a>
            </li>
        {% endif %}
        <li>
            <a class="govuk-link" href="#credential">Credential</a>
        </li>
    </ul>

    <!--PRE-AUTHORISED CODE-->
    <h1 class="govuk-heading-m" id="preauth">Pre-authorised Code:</h1>
    <pre class="monospace">{{ preAuthorizedCode }}</pre>

    <!--PRE-AUTHORISED CODE CLAIMS-->
    <h1 class="govuk-heading-m" id="preauthclaims">Pre-authorised Code Claims:</h1>
    <pre class="monospace">{{ preAuthorizedCodeClaims | dump(2) }}</pre>

    <!--ACCESS TOKEN-->
    <h1 class="govuk-heading-m" id="access">Access Token:</h1>
    <pre class="monospace">{{ accessToken }}</pre>

    <!--TOKEN CLAIMS-->
    <h1 class="govuk-heading-m" id="tokenclaims">Access Token Claims:</h1>
    <pre class="monospace">{{ accessTokenClaims | dump(2) }}</pre>

    <!--PROOF JWT-->
    <h1 class="govuk-heading-m" id="proofjwt">Proof JWT:</h1>
    <pre class="monospace">{{ proofJwt }}</pre>

    <!--PROOF JWT CLAIMS-->
    <h1 class="govuk-heading-m" id="proofjwtclaims">Proof JWT Claims:</h1>
    <pre class="monospace">{{ proofJwtClaims | dump(2)}}</pre>

    <!--CREDENTIAL EXPLORER-->
    <h1 class="govuk-heading-m" id="explorer">Credential Explorer:</h1>
    {% if credentialClaims %}
        <script>
            const credentialClaims = {
                data: {{ credentialClaims | safe }},
                ...jsontreeBindingOptions,
                title: {
                    text: "{{ credentialClaimsTitle }}",
                },
            }
        </script>
        <div id="tree-1" data-jsontree-js="credentialClaims"></div>
    {% endif %}
    {% if credentialSignature %}
        <script>
            const credentialSignature = {
                data: {{ credentialSignature | safe }},
                ...jsontreeBindingOptions,
                title: {
                    text: "mdoc Signature",
                },
            }
        </script>
        <div id="tree-2" data-jsontree-js="credentialSignature"></div>
    {% endif %}
    {% if credentialSignaturePayload %}
        <script>
            const credentialSignaturePayload = {
                data: {{ credentialSignaturePayload | safe }},
                ...jsontreeBindingOptions,
                title: {
                    text: "mdoc Signature Payload",
                },
            }
        </script>
        <div id="tree-3" data-jsontree-js="credentialSignaturePayload"></div>
    {% endif %}

    <!--X5 CHAIN-->
    {% if credentialSignature %}
        <h1 class="govuk-heading-m" id="x5chain">X509 Certificate Chain:</h1>
        <pre class="monospace">{{ x5chain }}</pre>
        <h1 class="govuk-heading-m" id="x5chainHex">X509 Certificate Chain Hex:</h1>
        <pre class="monospace">{{ x5chainHex }}</pre>
    {% endif %}

    <!--CREDENTIAL-->
    <h1 class="govuk-heading-m" id="credential">Credential:</h1>
    <pre class="monospace">{{ credential }}</pre>
{% endblock %}
